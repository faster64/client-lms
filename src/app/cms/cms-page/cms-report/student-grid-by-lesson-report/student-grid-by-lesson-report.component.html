<div class="student-grid-by-lesson-report-cpn">
  <div class="grid-content">

    <div class="grid-toolbar">

      <ng-container>
        <div class="left">
          BÁO CÁO SỐ LƯỢNG HỌC SINH THEO BÀI HỌC
        </div>
        <div class="right">
          <div class="select-type-btn" [matMenuTriggerFor]="menu">
            <div class="text">{{typeValue}}</div>
            <div class="icon"></div>
          </div>
        </div>
      </ng-container>
    </div>


    <div #gridContentBody class="grid-content-body">

      <!-- table  -->
      <div #table class="table">

        <!-- header  -->
        <div class="table-header">
          <div class="column column-header" [ngClass]="[col.column, col.class || '']" [ngStyle]="setWidth(col)"
            *ngFor="let col of displayColumns; index as i">
            <span class="text">{{col.displayText}}</span>

            <span class="filter bg-contain" [matMenuTriggerFor]="filterMenu" (click)="mapFilter(col)"
              *ngIf="col.filters && col.filters.length">
            </span>
          </div>
        </div>

        <!-- body -->
        <div class="table-body unselectable">

          <ng-container *ngIf="!isLoading && data && data.length">
            <ng-container *ngFor="let lesson of data">
              <div class="lesson-name" [ngClass]="lesson.collapse ? 'collapse' : ''" (click)="lesson.collapse = !lesson.collapse">
                <span>{{lesson.name}}</span>
                <span class="icon bg-contain"></span>
              </div>

              <ng-container *ngIf="!lesson.collapse">
                <div class="row-item" *ngFor="let item of lesson.students; index as i">

                  <div class="column column-body"
                    [ngClass]="[col.column, col.class || '', col.type == FieldType.Password ? 'password-field' : '']"
                    [ngStyle]="setWidth(col)" *ngFor="let col of displayColumns; index as i">
                    <ng-container [ngSwitch]="col.type" *ngIf="item[col.column]">

                      <!-- Nếu là link    -->
                      <a *ngSwitchCase="FieldType.Link" [href]="col.getLink(item) || item[col.column]"
                        [target]="col.target ?? '_self'" [matTooltip]="Utility.removeHtml(item[col.column])"
                        [innerHTML]="item[col.column]" class="over-3-dots">
                      </a>

                      <img *ngSwitchCase="FieldType.Image" [src]="item[col.column]">

                      <!-- Nếu là số  -->
                      <p *ngSwitchCase="FieldType.Number"
                        [matTooltip]="Utility.removeHtml(item[col.column] | NumberFormatPipe)"
                        [innerHTML]="item[col.column] | NumberFormatPipe" class="over-3-dots">
                      </p>

                      <!-- Nếu là số không format  -->
                      <p *ngSwitchCase="FieldType.NumberNoFormat" [matTooltip]="Utility.removeHtml(item[col.column])"
                        [innerHTML]="item[col.column]" class="over-3-dots">
                      </p>

                      <!-- Nếu là ngày  -->
                      <p *ngSwitchCase="FieldType.Date"
                        [matTooltip]="Utility.removeHtml(item[col.column] | DateVietnamPipe)"
                        [innerHTML]="item[col.column] | DateVietnamPipe" class="over-3-dots">
                      </p>

                      <!-- Nếu là ngày giờ -->
                      <p *ngSwitchCase="FieldType.DateTime"
                        [matTooltip]="Utility.removeHtml(item[col.column] | DateTimeVietnamPipe)"
                        [innerHTML]="item[col.column] | DateTimeVietnamPipe" class="over-3-dots">
                      </p>

                      <!-- Default  -->
                      <p *ngSwitchDefault [matTooltip]="Utility.removeHtml(item[col.column])"
                        [innerHTML]="item[col.column] || ''" class="over-3-dots">
                      </p>
                    </ng-container>

                    <ng-container *ngIf="!item[col.column]">
                      <span class="empty">-</span>
                    </ng-container>
                  </div>

                </div>
              </ng-container>

              <div class="no-data dis-flex" style="height: 120px; min-height: 120px;" *ngIf="!lesson.collapse && (!lesson.students || !lesson.students.length)">
                {{'base_keys.no_data' | translate}}
              </div>

            </ng-container>
          </ng-container>

        </div>

      </div>

    </div>

    <progess-spinner-loading *ngIf="isLoading"></progess-spinner-loading>
  </div>
</div>


<mat-menu #filterMenu="matMenu">
  <div class="filter-grid-menu">
    <div class="data-item" [ngClass]="i == menuDataIndex ? 'selected' : ''"
      *ngFor="let item of menuData.filters; index as i" (click)="fieldFilter(menuData.field, item, i)">
      {{item.text}}
    </div>
  </div>
</mat-menu>


<mat-menu #menu="matMenu" class="type-grid">
  <div class="type-grid-menu">
    <div class="sgm-item" (click)="typeValue = 'Thống kê số lượng học sinh'; navigate()">
      <div class="text">Thống kê số lượng học sinh</div>
    </div>
  </div>
</mat-menu>
